---
title: "Environmental Correlations"
author: "FiG-T"
data: "`r Sys.Date()`"
output: 
  html_document: 
    keep_md: yes
    toc: yes
toc: TRUE
editor_options:
  markdown:
    wrap: 80
  chunk_output_type: inline
---


```{r libraries, message=FALSE}

# load required libraries
library(feather)
library(dplyr)
library(ggplot2)
library(stringr)
library(tidyr)
library(Hmisc)
```

```{r required_data}
gt_pc_ds_paleobio_meta <- feather::read_feather(
  path = "data/feather/paleobio_meta_pc_ds_subset_full_08_2024.feather"
)
```


## Correlations between variables

As I was not exactly sure which variables (especially the quarterly paleo ones)
are highly related predictors, I wanted to check which (if any) result in highly
correlated responses.

For now I have decided to keep all variables, but the number of predictors could
be slimmed down by removing on of two predictors that are highly correlated with
each other.

```{r env_correlations}
# calculate correlations between variables 
env_cor <- Hmisc::rcorr(
  as.matrix(
    gt_pc_ds_paleobio_meta[,c(9,15:22,29,31:42)]
  )
)

# blank out half values to avoid repeats 
env_cor$r[lower.tri(env_cor$r)] <- NA

# transform matrix into a table 
env_cor <- reshape2::melt(
  env_cor$r,
  na.rm = TRUE
)

# round to 3 digits 
env_cor$value <- round(
  x = env_cor$value, 
  digits = 3
)
```

```{r plot_env_correlations}
ggplot2::ggplot(
  data = env_cor,
  ggplot2::aes(
    x = Var2,
    y = Var1,
    fill = value
  )
) +
  geom_tile(
    colour = "white"
  ) +
  geom_text(
    mapping = aes(
      label = value
    ),
    colour = "white",
    #size = 1.25 # if saving to pdf
    size = 2.5
  ) +
  xlab("")+
  ylab("")+
  labs(fill = "R-squared Correlation Coefficient") +
  scale_fill_gradient2(
    low = "navy",
    high = "maroon3",
    mid = "snow3",
    midpoint = 0,
    #limit = c(0.5,1),
    #space = "Lab",
    #name="Pearson\nCorrelation"
  ) +
  theme_light()+
  theme(
    axis.text.x = element_text(
      angle = 90,
      vjust = 0.5
    ), 
    legend.position = "bottom"
    # axis.title = element_blank(), 
    # legend.position = "none"
  ) #+
  #transparent_theme
```

```{r save_env_corr}
ggplot2::ggsave(
  filename = "/figures/supplementary/lhf_env_corr_heatmap_08_2024.png",
  plot = last_plot(),
  bg = "transparent", 
  width = 12, 
  height = 10
)
```
